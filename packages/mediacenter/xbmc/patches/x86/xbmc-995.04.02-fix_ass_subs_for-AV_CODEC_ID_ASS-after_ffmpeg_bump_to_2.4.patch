From 33ecbf84af6cd890ffb6a2562e8d4b6ce65729e5 Mon Sep 17 00:00:00 2001
From: Rainer Hochecker <fernetmenta@online.de>
Date: Fri, 26 Sep 2014 07:50:56 +0200
Subject: [PATCH] dvdplayer: fix ass subs for AV_CODEC_ID_ASS after ffmpeg bump
 to 2.4

---
 xbmc/cores/dvdplayer/DVDCodecs/Overlay/DVDOverlayCodecSSA.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/xbmc/cores/dvdplayer/DVDCodecs/Overlay/DVDOverlayCodecSSA.cpp b/xbmc/cores/dvdplayer/DVDCodecs/Overlay/DVDOverlayCodecSSA.cpp
index 7cd6c2d..755eb6b 100644
--- a/xbmc/cores/dvdplayer/DVDCodecs/Overlay/DVDOverlayCodecSSA.cpp
+++ b/xbmc/cores/dvdplayer/DVDCodecs/Overlay/DVDOverlayCodecSSA.cpp
@@ -71,6 +71,8 @@ int CDVDOverlayCodecSSA::Decode(DemuxPacket *pPacket)
     return OC_ERROR;
   
   double pts = pPacket->dts != DVD_NOPTS_VALUE ? pPacket->dts : pPacket->pts;
+  if (pts == DVD_NOPTS_VALUE)
+    pts = 0;
   uint8_t *data = pPacket->pData;
   int size = pPacket->iSize;
   double duration = pPacket->duration;
@@ -118,6 +120,14 @@ int CDVDOverlayCodecSSA::Decode(DemuxPacket *pPacket)
   else
     m_libass->DecodeDemuxPkt((char*)data, size, pts, duration);
 
+  if (m_pOverlay && m_pOverlay->iPTSStartTime == pts)
+  {
+    if (m_pOverlay->iPTSStopTime < pts + duration)
+      m_pOverlay->iPTSStopTime = pts + duration;
+    m_output = true;
+    return OC_OVERLAY;
+  }
+
   if(m_pOverlay)
   {
     /* there will only ever be one active, so we 
